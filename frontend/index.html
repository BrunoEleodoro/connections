<!-- Connections - Network & Connect App -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0">
    <title>Connections - Network & Connect App</title>
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          container: {
            center: true,
            padding: '2rem',
            screens: {
              '2xl': '1400px'
            }
          },
          extend: {
            colors: {
              border: 'hsl(var(--border))',
              input: 'hsl(var(--input))',
              ring: 'hsl(var(--ring))',
              background: 'hsl(var(--background))',
              foreground: 'hsl(var(--foreground))',
              primary: {
                DEFAULT: 'hsl(var(--primary))',
                foreground: 'hsl(var(--primary-foreground))'
              },
              secondary: {
                DEFAULT: 'hsl(var(--secondary))',
                foreground: 'hsl(var(--secondary-foreground))'
              },
              destructive: {
                DEFAULT: 'hsl(var(--destructive))',
                foreground: 'hsl(var(--destructive-foreground))'
              },
              muted: {
                DEFAULT: 'hsl(var(--muted))',
                foreground: 'hsl(var(--muted-foreground))'
              },
              accent: {
                DEFAULT: 'hsl(var(--accent))',
                foreground: 'hsl(var(--accent-foreground))'
              },
              popover: {
                DEFAULT: 'hsl(var(--popover))',
                foreground: 'hsl(var(--popover-foreground))'
              },
              card: {
                DEFAULT: 'hsl(var(--card))',
                foreground: 'hsl(var(--card-foreground))'
              },
              sidebar: {
                DEFAULT: 'hsl(var(--sidebar-background))',
                foreground: 'hsl(var(--sidebar-foreground))',
                primary: 'hsl(var(--sidebar-primary))',
                'primary-foreground': 'hsl(var(--sidebar-primary-foreground))',
                accent: 'hsl(var(--sidebar-accent))',
                'accent-foreground': 'hsl(var(--sidebar-accent-foreground))',
                border: 'hsl(var(--sidebar-border))',
                ring: 'hsl(var(--sidebar-ring))'
              },
              glass: 'rgba(255,255,255,0.10)',
              'glass-border': 'rgba(255,255,255,0.20)'
            },
            borderRadius: {
              lg: 'var(--radius)',
              md: 'calc(var(--radius) - 2px)',
              sm: 'calc(var(--radius) - 4px)'
            },
            keyframes: {
              'accordion-down': {
                from: { height: '0' },
                to: { height: 'var(--radix-accordion-content-height)' }
              },
              'accordion-up': {
                from: { height: 'var(--radix-accordion-content-height)' },
                to: { height: '0' }
              },
              'fade-in': {
                '0%': { opacity: '0', transform: 'translateY(20px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' }
              },
              'slide-up': {
                '0%': { opacity: '0', transform: 'translateY(50px)' },
                '100%': { opacity: '1', transform: 'translateY(0)' }
              },
              'scale-in': {
                '0%': { opacity: '0', transform: 'scale(0.95)' },
                '100%': { opacity: '1', transform: 'scale(1)' }
              }
            },
            animation: {
              'accordion-down': 'accordion-down 0.2s ease-out',
              'accordion-up': 'accordion-up 0.2s ease-out',
              'fade-in': 'fade-in 0.5s ease-out forwards',
              'slide-up': 'slide-up 0.6s ease-out forwards',
              'scale-in': 'scale-in 0.3s ease-out forwards'
            }
          }
        }
      };
    </script>
    <style>
      html,body{max-width:100vw;overflow-x:hidden;}
      #my-qr-reader video,#my-qr-reader canvas{width:100% !important;height:auto !important;}
      html, body { height: 100%; min-height: 100vh; }
      body { min-height: 100vh; }
      .glass {
        background: rgba(255,255,255,0.10);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(255,255,255,0.20);
      }
    </style>
    <!-- Design tokens -->
    <style type="text/tailwindcss">
@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;

    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;

    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;

    --primary: 222.2 47.4% 11.2%;
    --primary-foreground: 210 40% 98%;

    --secondary: 210 40% 96.1%;
    --secondary-foreground: 222.2 47.4% 11.2%;

    --muted: 210 40% 96.1%;
    --muted-foreground: 215.4 16.3% 46.9%;

    --accent: 210 40% 96.1%;
    --accent-foreground: 222.2 47.4% 11.2%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;

    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 222.2 84% 4.9%;

    --radius: 0.5rem;

    --sidebar-background: 0 0% 98%;
    --sidebar-foreground: 240 5.3% 26.1%;
    --sidebar-primary: 240 5.9% 10%;
    --sidebar-primary-foreground: 0 0% 98%;
    --sidebar-accent: 240 4.8% 95.9%;
    --sidebar-accent-foreground: 240 5.9% 10%;
    --sidebar-border: 220 13% 91%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;

    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;

    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;

    --primary: 210 40% 98%;
    --primary-foreground: 222.2 47.4% 11.2%;

    --secondary: 217.2 32.6% 17.5%;
    --secondary-foreground: 210 40% 98%;

    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;

    --accent: 217.2 32.6% 17.5%;
    --accent-foreground: 210 40% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;

    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 212.7 26.8% 83.9%;

    --sidebar-background: 240 5.9% 10%;
    --sidebar-foreground: 240 4.8% 95.9%;
    --sidebar-primary: 224.3 76.3% 48%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 240 3.7% 15.9%;
    --sidebar-accent-foreground: 240 4.8% 95.9%;
    --sidebar-border: 240 3.7% 15.9%;
    --sidebar-ring: 217.2 91.2% 59.8%;
  }

  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
  }
}
</style>
</head>

<body class="min-h-screen bg-gradient-to-br from-blue-900 via-purple-900 to-slate-900 text-white">
    <div class="container mx-auto p-4 flex flex-col min-h-screen space-y-6 justify-center items-center">
        <!-- Telegram User Header (conditionally rendered) -->
        <div id="tg-user-header" class="glass rounded-2xl p-4 w-full max-w-2xl flex items-center justify-between mb-4 shadow-lg hidden">
            <div class="flex items-center gap-4">
                <div id="tg-avatar" class="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center text-xl font-bold text-white"></div>
                <div>
                    <div id="tg-fullname" class="font-semibold text-white"></div>
                    <div id="tg-username" class="text-white/70 text-sm"></div>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <span class="px-2 py-1 rounded bg-white/10 text-xs font-medium text-white/70 border border-white/20">Connected user</span>
                <button id="open-config-btn" class="text-white/70 hover:text-white text-2xl" title="Configurations">⚙️</button>
            </div>
        </div>
        <!-- Main Title Section -->
        <div class="text-center space-y-2">
            <h1 class="text-4xl md:text-5xl font-bold text-white drop-shadow-lg">Connections</h1>
            <p class="text-white/70 text-lg">Scan QR codes to build your network</p>
        </div>
        <!-- Events Management Card -->
        <div class="glass rounded-2xl p-6 w-full max-w-2xl shadow-lg">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-white/80"><path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975M15 9.75a3 3 0 11-6 0 3 3 0 016 0zm6 2.25a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    <h2 class="text-2xl font-semibold text-white">Events</h2>
                </div>
                <button id="add-event-btn" class="px-4 py-2 rounded-lg bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold shadow hover:from-blue-700 hover:to-purple-700 transition">Add Event</button>
            </div>
            <p class="text-white/50 mb-4">Organize your connections by events</p>
            <div id="events-list" class="space-y-4">
                <!-- Event cards will be rendered here -->
                <div id="empty-events" class="text-center text-white/50 py-8">No events yet. Create your first event to get started!</div>
            </div>
        </div>
        <!-- QR Scanning Interface -->
        <div id="qr-section" class="glass rounded-2xl p-6 w-full max-w-2xl shadow-lg mt-4">
            <!-- State A: Ready to Scan (replaced by QR code) -->
            <div id="qr-ready" class="flex flex-col items-center space-y-4">
                <div id="my-qr-code" class="mb-2"></div>
                <h3 class="text-xl font-semibold text-white">Share your Telegram QR Code</h3>
                <p class="text-white/50 text-center">Let others scan your code to connect with you instantly.</p>
            </div>
            <!-- State B: Scanning Animation -->
            <div id="qr-scanning" class="flex flex-col items-center space-y-4 hidden">
                <div class="w-16 h-16 flex items-center justify-center rounded-full border-4 border-blue-500 animate-pulse bg-white/10">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 48 48" stroke-width="1.5" stroke="currentColor" class="w-12 h-12 text-blue-400 animate-spin-slow"><rect x="8" y="8" width="32" height="32" rx="6" stroke="currentColor" stroke-width="3" fill="none"/><path d="M16 16h2v2h-2zM30 16h2v2h-2zM16 30h2v2h-2zM30 30h2v2h-2z" fill="currentColor"/></svg>
                </div>
                <div class="text-white/70 text-lg">Scanning for QR code...</div>
            </div>
            <!-- State C: Save Connection Form -->
            <div id="qr-save-form" class="space-y-4 hidden">
                <div class="flex items-center gap-3">
                    <span class="px-3 py-1 rounded bg-green-600/80 text-white font-semibold">@<span id="scanned-username">username</span></span>
                    <span class="text-white/70">Scanned profile</span>
                </div>
                <label for="event-select" class="block text-white/70">Select Event</label>
                <select id="event-select" class="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white">
                    <!-- Populated dynamically -->
                </select>
                <label for="notes-area" class="block text-white/70">Notes</label>
                <textarea id="notes-area" rows="3" placeholder="What did you discuss?" class="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white"></textarea>
                <div class="flex gap-3 justify-end">
                    <button id="cancel-save-btn" class="px-4 py-2 rounded-lg border border-white/20 text-white/70 hover:text-white transition">Cancel</button>
                    <button id="save-connection-btn" class="px-4 py-2 rounded-lg bg-gradient-to-r from-green-500 to-blue-500 text-white font-semibold shadow hover:from-green-600 hover:to-blue-600 transition">Save</button>
                </div>
            </div>
        </div>
        <!-- Toast Notifications -->
        <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 px-6 py-3 rounded-lg bg-white/90 text-gray-900 font-semibold shadow-lg hidden"></div>
    </div>
    <!-- Add Event Modal -->
    <div id="add-event-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="glass rounded-lg p-6 w-11/12 max-w-md animate-scale-in">
            <h2 class="text-xl font-semibold mb-4">Add Event</h2>
            <input id="new-event-name" type="text" placeholder="Event name" class="w-full border border-white/20 bg-white/10 rounded-lg p-3 mb-4 text-white" />
            <div id="event-error" class="text-red-400 text-sm mb-2 hidden">Event name is required.</div>
            <div class="flex justify-end gap-3">
                <button id="cancel-add-event" class="px-4 py-2 rounded-lg border border-white/20 text-white/70 hover:text-white transition">Cancel</button>
                <button id="add-event-save-btn" class="px-4 py-2 rounded-lg bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold hover:from-blue-700 hover:to-purple-700">Save</button>
            </div>
        </div>
    </div>
    <!-- Config Modal -->
    <div id="config-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="glass rounded-lg p-6 w-11/12 max-w-md animate-scale-in">
            <h2 class="text-xl font-semibold mb-4">Blurb message</h2>
            <textarea id="blurb-textarea" rows="6" class="w-full border border-white/20 bg-white/10 rounded-lg p-3 text-white resize-y"></textarea>
            <div class="flex justify-end gap-3 mt-4">
                <button id="cancel-config-btn" class="px-4 py-2 rounded-lg border border-white/20 text-white/70 hover:text-white transition">Cancel</button>
                <button id="save-config-btn" class="px-4 py-2 rounded-lg bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold hover:from-blue-700 hover:to-purple-700">Save</button>
            </div>
        </div>
    </div>
    <!-- Notes Modal (after scan) -->
    <div id="notes-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="glass rounded-lg p-6 w-11/12 max-w-md animate-scale-in">
            <h2 class="text-xl font-semibold mb-4">What did you discuss with <span id="modal-username" class="text-emerald-400"></span>?</h2>
            <label for="modal-event-select" class="block text-white/70 mb-1">Select Event</label>
            <select id="modal-event-select" class="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white mb-4"></select>
            <textarea id="modal-notes" rows="4" placeholder="Type your notes here..." class="w-full border border-white/20 bg-white/10 rounded-lg p-3 text-white resize-y mb-4"></textarea>
            <div class="flex justify-end gap-3">
                <button id="notes-cancel-btn" class="px-4 py-2 rounded-lg border border-white/20 text-white/70 hover:text-white transition">Cancel</button>
                <button id="notes-save-btn" class="px-4 py-2 rounded-lg bg-gradient-to-r from-green-500 to-blue-500 text-white font-semibold hover:from-green-600 hover:to-blue-600">Save</button>
            </div>
        </div>
    </div>
    <!-- QR Code Scanner Library -->
    <script src="https://unpkg.com/html5-qrcode"></script>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="src/script.js"></script>
    <!-- Add full-screen chat overlay -->
    <div id="chat-overlay" class="fixed inset-0 bg-black/90 flex flex-col z-50 hidden">
      <div class="flex items-center p-4 border-b border-white/10">
        <button id="chat-back-btn" class="text-white/80 hover:text-white text-2xl mr-4">&larr;</button>
        <h2 class="text-xl font-semibold text-white">AI Event Assistant</h2>
      </div>
      <div id="chat-messages" class="flex-1 overflow-y-auto space-y-3 p-4 bg-white/5"></div>
      <form id="chat-form" class="flex gap-2 p-4 border-t border-white/10 bg-black/80">
        <input id="chat-input" type="text" placeholder="Ask about this event's contacts..." class="flex-1 p-2 rounded bg-white/10 border border-white/20 text-white" autocomplete="off" required />
        <button type="submit" class="px-4 py-2 rounded bg-gradient-to-r from-blue-500 to-purple-500 text-white font-semibold hover:from-blue-600 hover:to-purple-600">Send</button>
      </form>
    </div>
</body>

</html>